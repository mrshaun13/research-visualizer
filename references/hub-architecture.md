# Research Hub Architecture

The Research Hub is a single web application that hosts all research projects generated by the research-visualizer skill. Instead of scaffolding a new standalone Vite project for each research topic, all projects live under one hub with a unified navigation experience.

## Config File

**Location:** `~/.codeium/windsurf/skills/research-visualizer/config.json`

This file is the **installation detection marker**. If it exists, the hub has been set up. If it doesn't exist, this is a first-time run.

### Schema

```json
{
  "version": "1.0",
  "created": "2026-02-09T20:00:00Z",
  "hubPath": "/home/user/research-hub",
  "port": 5180,
  "projects": [
    {
      "slug": "chainsaw-comparison",
      "title": "Gas Chainsaw Comparison",
      "subtitle": "Product Comparison Dashboard",
      "query": "I'm looking to buy a gas chainsaw for property maintenance",
      "lens": "product",
      "icon": "axe",
      "accentColor": "orange",
      "createdAt": "2026-02-09T12:00:00Z",
      "updatedAt": "2026-02-09T14:00:00Z"
    }
  ]
}
```

### Fields

| Field | Type | Description |
|---|---|---|
| `version` | string | Config schema version |
| `created` | ISO 8601 | When the hub was first set up |
| `hubPath` | string | Absolute path to the hub directory |
| `port` | number | Vite dev server port (default: 5180) |
| `projects` | array | All registered research projects |
| `projects[].slug` | string | URL-safe directory name (kebab-case) |
| `projects[].title` | string | Display title for sidebar and cards |
| `projects[].subtitle` | string | Short description shown under title |
| `projects[].query` | string | The original user query that triggered this research |
| `projects[].lens` | string | Research lens: "standard", "product", "population", etc. |
| `projects[].icon` | string | Lucide icon name for sidebar display |
| `projects[].accentColor` | string | Tailwind color name for project theming (e.g., "cyan", "orange") |
| `projects[].createdAt` | ISO 8601 | When the project was first created |
| `projects[].updatedAt` | ISO 8601 | Last modification time |
| `projects[].telemetry` | object | Run telemetry and project statistics (see Telemetry Schema below) |

## Telemetry Schema

Every project tracks telemetry about its creation and the research run that produced it. This data is stored in `config.json` under each project's `telemetry` field and mirrored in `projects/index.js` for display in the hub UI.

### Example

```json
"telemetry": {
  "runStartedAt": "2026-02-09T12:00:00Z",
  "runCompletedAt": "2026-02-09T14:30:00Z",
  "durationMinutes": 150,
  "includedSetup": false,
  "skillVersion": "4.0",
  "userPrompt": "I'm looking to buy a gas chainsaw for property maintenance",
  "researchPlan": "PRODUCT TYPE: Gas Chainsaw\nLIFECYCLE: Durable / Investment\n...",
  "checkpointModified": false,
  "model": "claude-sonnet-4-20250514",
  "tokenUsage": null,
  "searchesPerformed": 24,
  "sourcesCount": 18,
  "sectionsBuilt": 8,
  "chartsBuilt": 12,
  "filesGenerated": 14,
  "productsCompared": 18,
  "dataPointsCollected": 216,
  "phaseTiming": {
    "environment": 2,
    "interpret": 5,
    "survey": 15,
    "discover": 20,
    "research": 45,
    "analyze": 10,
    "build": 40,
    "present": 13
  }
}
```

### Telemetry Fields

| Field | Type | Required | Description |
|---|---|---|---|
| `runStartedAt` | ISO 8601 | ✓ | Timestamp when the skill invocation began (Phase 0 start) |
| `runCompletedAt` | ISO 8601 | ✓ | Timestamp when Phase 7 finished |
| `durationMinutes` | number | ✓ | Total wall-clock minutes from start to finish |
| `includedSetup` | boolean | ✓ | Whether Phase 0B (first-time hub setup) was part of this run |
| `skillVersion` | string | ✓ | Version from SKILL.md frontmatter (e.g., "4.0") |
| `userPrompt` | string | ✓ | The exact original prompt the user provided to trigger the skill |
| `researchPlan` | string | ✓ | The full research plan text presented at the Phase 3D checkpoint |
| `checkpointModified` | boolean | ✓ | Whether the user requested changes at the checkpoint |
| `model` | string | optional | LLM model identifier (e.g., "claude-sonnet-4-20250514", "gpt-4o") |
| `tokenUsage` | number\|null | optional | Approximate total tokens consumed during the run, null if unavailable |
| `searchesPerformed` | number | ✓ | Total web searches executed across all phases |
| `sourcesCount` | number | ✓ | Number of unique sources cited in the final dashboard |
| `sectionsBuilt` | number | ✓ | Number of dashboard sections created |
| `chartsBuilt` | number | ✓ | Number of individual chart/visualization components |
| `filesGenerated` | number | ✓ | Total files written to the project directory |
| `productsCompared` | number\|null | optional | Number of products in comparison (Product lens only, null otherwise) |
| `dataPointsCollected` | number | ✓ | Approximate count of individual data points gathered during research |
| `phaseTiming` | object | ✓ | Per-phase duration in minutes |
| `phaseTiming.environment` | number | | Minutes spent in Phase 0 |
| `phaseTiming.interpret` | number | | Minutes spent in Phase 1 |
| `phaseTiming.survey` | number | | Minutes spent in Phase 2 |
| `phaseTiming.discover` | number | | Minutes spent in Phase 3 |
| `phaseTiming.research` | number | | Minutes spent in Phase 4 |
| `phaseTiming.analyze` | number | | Minutes spent in Phase 5 |
| `phaseTiming.build` | number | | Minutes spent in Phase 6 |
| `phaseTiming.present` | number | | Minutes spent in Phase 7 |

### Content Analysis (Readability & Cognitive Depth)

Captured in Phase 7 by analyzing all text content in the dashboard (insight callouts, section descriptions, data labels, tooltip text, recommendation text).

```json
"contentAnalysis": {
  "fleschKincaidGrade": 10.2,
  "fleschKincaidLabel": "10th Grade",
  "bloomsLevel": 4,
  "bloomsLabel": "Analyze",
  "bloomsRange": "Understand → Evaluate",
  "totalWords": 4500,
  "totalSentences": 225,
  "readabilityNote": "College-prep level with data-driven analytical content"
}
```

| Field | Type | Description |
|---|---|---|
| `fleschKincaidGrade` | number | Flesch-Kincaid grade level. Formula: `0.39 × (words/sentences) + 11.8 × (syllables/words) − 15.59` |
| `fleschKincaidLabel` | string | Human-readable label (e.g., "10th Grade", "College", "7th Grade") |
| `bloomsLevel` | number | Dominant Bloom's Taxonomy level (1-6): 1=Remember, 2=Understand, 3=Apply, 4=Analyze, 5=Evaluate, 6=Create |
| `bloomsLabel` | string | Label for the dominant level |
| `bloomsRange` | string | Range of cognitive levels present (e.g., "Understand → Evaluate") |
| `totalWords` | number | Total word count across all dashboard text content |
| `totalSentences` | number | Total sentence count |
| `readabilityNote` | string | Brief characterization of the content's reading experience |

**Bloom's Level Assessment Guide:**
- **Data tables, raw stats, timelines** → Remember (1) / Understand (2)
- **Comparative charts, trend analysis** → Analyze (4)
- **Insight callouts with "why" explanations** → Analyze (4)
- **Recommendations, decision frameworks, verdicts** → Evaluate (5)
- **Interactive filtering that reveals patterns** → Apply (3) / Analyze (4)
- Assign the level that covers >50% of the dashboard's content. Note the full range.

### Hours Saved Estimation

Estimates the equivalent manual effort a human would need to produce the same research and output. Calculated in Phase 7 based on build metrics.

```json
"hoursSaved": {
  "researchHours": 18.5,
  "productionHours": {
    "interactive-dashboard": 62,
    "white-paper": 35,
    "blog-post": 22,
    "technical-doc": 28,
    "presentation": 15,
    "github-repo": 38
  },
  "totalHoursSaved": 80.5,
  "equivalentLabel": "~2 weeks full-time"
}
```

| Field | Type | Description |
|---|---|---|
| `researchHours` | number | Estimated hours a human would spend on research alone |
| `productionHours` | object | Estimated production hours by output format |
| `productionHours.interactive-dashboard` | number | Hours to hand-build the equivalent React dashboard |
| `productionHours.white-paper` | number | Hours to write an equivalent white paper |
| `productionHours.blog-post` | number | Hours to write an equivalent blog post series |
| `productionHours.technical-doc` | number | Hours to write an equivalent RFC/technical document |
| `productionHours.presentation` | number | Hours to create an equivalent slide deck |
| `productionHours.github-repo` | number | Hours to build an equivalent documented repo |
| `totalHoursSaved` | number | `researchHours + productionHours['interactive-dashboard']` |
| `equivalentLabel` | string | Human-readable equivalent (e.g., "~2 weeks full-time", "~1 week full-time") |

**Estimation Formulas:**
```
researchHours = (sourcesCount × 0.75) + (dataPointsCollected × 0.02) + (searchesPerformed × 0.25)

productionHours['interactive-dashboard'] = (sectionsBuilt × 6) + (chartsBuilt × 3) + (filesGenerated × 0.5)
productionHours['white-paper']           = (sectionsBuilt × 4) + (sourcesCount × 0.5) + (dataPointsCollected × 0.01)
productionHours['blog-post']             = (sectionsBuilt × 2.5) + (chartsBuilt × 1)
productionHours['technical-doc']         = (sectionsBuilt × 3) + (sourcesCount × 0.3)
productionHours['presentation']          = (sectionsBuilt × 1.5) + (chartsBuilt × 0.5)
productionHours['github-repo']           = (sectionsBuilt × 3) + (chartsBuilt × 2) + (filesGenerated × 0.5)

totalHoursSaved = researchHours + productionHours['interactive-dashboard']
equivalentLabel = totalHoursSaved < 20 ? "~X days" : "~Y weeks full-time"
```

### Consumption Time

Estimates how long a human reader (matching the Flesch-Kincaid level) would need to fully consume the dashboard content.

```json
"consumptionTime": {
  "estimatedMinutes": 45,
  "readingMinutes": 30,
  "chartExplorationMinutes": 10.5,
  "interactiveOverheadMinutes": 4.5,
  "estimatedLabel": "~45 min deep read"
}
```

| Field | Type | Description |
|---|---|---|
| `estimatedMinutes` | number | Total estimated consumption time in minutes |
| `readingMinutes` | number | Time to read all text content |
| `chartExplorationMinutes` | number | Time to meaningfully interpret all charts |
| `interactiveOverheadMinutes` | number | Additional time for interactive exploration (filtering, drilling down) |
| `estimatedLabel` | string | Human-readable label (e.g., "~45 min deep read", "~1.5 hr deep read") |

**Estimation Formulas:**
```
readingWPM = fleschKincaidGrade > 12 ? 120 : 150   // slower for college+ level
readingMinutes = totalWords / readingWPM
chartExplorationMinutes = chartsBuilt × 0.75        // ~45 seconds per chart
interactiveOverheadMinutes = (readingMinutes + chartExplorationMinutes) × 0.2
estimatedMinutes = readingMinutes + chartExplorationMinutes + interactiveOverheadMinutes
```

### When to Capture

| Data Point | Capture Moment |
|---|---|
| `runStartedAt` | Phase 0 — immediately when skill begins |
| `includedSetup` | Phase 0 — set to true if Phase 0B runs |
| `skillVersion` | Phase 0 — read from SKILL.md frontmatter |
| `userPrompt` | Phase 1 — the raw user input before interpretation |
| `researchPlan` | Phase 3D — the full checkpoint text shown to the user |
| `checkpointModified` | Phase 3D — whether user requested adjustments |
| `model` | Phase 0 — note the current model if detectable |
| `searchesPerformed` | Phases 2-4 — increment counter with each web search |
| `sourcesCount` | Phase 6 — count unique sources in the data files |
| `sectionsBuilt`, `chartsBuilt`, `filesGenerated` | Phase 6 — count after build completes |
| `productsCompared` | Phase 6 — count products array length (Product lens) |
| `dataPointsCollected` | Phase 4 — count data points gathered |
| `phaseTiming.*` | Each phase — note start/end timestamps, calculate delta |
| `contentAnalysis.*` | Phase 7 — analyze all text in built components |
| `hoursSaved.*` | Phase 7 — calculate from build metrics using formulas above |
| `consumptionTime.*` | Phase 7 — calculate from word count + chart count + FK grade |
| `runCompletedAt`, `durationMinutes` | Phase 7 — final timestamp and total calculation |
| `tokenUsage` | Phase 7 — if available from the runtime environment |

## Hub Directory Structure

```
<hubPath>/                              (e.g., ~/research-hub/)
├── package.json
├── vite.config.js
├── tailwind.config.js
├── postcss.config.js
├── index.html
└── src/
    ├── main.jsx
    ├── index.css
    ├── App.jsx                          ← Hub shell: collapsible sidebar + project routing
    ├── components/
    │   └── HubHome.jsx                  ← Landing page with project cards grid
    └── projects/
        ├── index.js                     ← Project registry: imports + metadata exports
        ├── cisco-history-dashboard/
        │   ├── App.jsx                  ← Original project App (unchanged)
        │   ├── components/
        │   │   ├── Overview.jsx
        │   │   └── ...
        │   └── data/
        │       └── ciscoData.js
        └── chainsaw-comparison/
            ├── App.jsx
            ├── components/
            │   ├── Overview.jsx
            │   └── ...
            └── data/
                ├── products.js
                └── productDetails.js
```

## Project Registry (src/projects/index.js)

This file is the bridge between the hub shell and individual projects. It exports:
1. `projectRegistry` — array of metadata objects (title, slug, icon, etc.)
2. `projectComponents` — map of slug → lazy-loaded React component

```javascript
import { lazy } from 'react';

export const projectRegistry = [
  {
    slug: 'cisco-history-dashboard',
    title: 'Cisco History Dashboard',
    subtitle: '40 Years of Innovation',
    query: 'Research the history of Cisco Systems...',
    lens: 'standard',
    icon: 'Building2',
    accentColor: 'cyan',
    createdAt: '2026-02-08T12:00:00Z',
  },
  {
    slug: 'chainsaw-comparison',
    title: 'Gas Chainsaw Comparison',
    subtitle: 'Product Comparison Dashboard',
    query: "I'm looking to buy a gas chainsaw",
    lens: 'product',
    icon: 'Axe',
    accentColor: 'orange',
    createdAt: '2026-02-09T12:00:00Z',
  },
];

export const projectComponents = {
  'cisco-history-dashboard': lazy(() => import('./cisco-history-dashboard/App')),
  'chainsaw-comparison': lazy(() => import('./chainsaw-comparison/App')),
};
```

**When adding a new project**, the skill:
1. Creates the project directory under `src/projects/<slug>/`
2. Adds an import line and registry entry to `src/projects/index.js`
3. Adds the project to `config.json`

## Hub App Shell Design

The hub uses a **ChatGPT-style layout**:

### Sidebar (collapsible)
- **Header**: "Research Hub" branding with a collapse toggle
- **Project list**: Each project shows icon + title + date, sorted newest-first
- **Active indicator**: Highlighted item for currently viewed project
- **Home button**: Returns to the hub landing page
- Sidebar collapses to icon-only mode; expands on hover or click

### Main Content Area
- **Home view** (no project selected): Grid of project cards with title, subtitle, lens badge, date, accent color border. Click to navigate.
- **Project view** (project selected): Renders the project's App component full-width. The project's own internal sidebar/nav is preserved as-is.

### Responsive
- On mobile: sidebar is a slide-out drawer with overlay
- On desktop: sidebar is persistent, collapsible

## Adding a New Project (Skill Workflow)

When the skill runs Phase 6 (BUILD) and the hub already exists:

1. **Create project directory**: `<hubPath>/src/projects/<slug>/`
2. **Write all project files** (App.jsx, components/, data/) into that directory — same structure as before, just nested under the hub
3. **Update registry**: Add import + metadata entry to `src/projects/index.js`
4. **Update config**: Add project entry to `config.json`
5. **Skip npm install** if no new dependencies (the hub already has React, Recharts, Tailwind, Lucide)
6. **Tell user to refresh browser** — Vite HMR will pick up new files automatically if dev server is running; if not, start it

## First-Time Setup Flow

When the skill detects no `config.json`:

1. **Inform user**: "I see this is your first time running Research Visualizer. I need to set up a Research Hub — a single web app that will host all your research dashboards."
2. **Ask for location**: "Where would you like to install the Research Hub? Default: `~/research-hub/`"
3. **Scaffold hub**: Create all hub files (package.json, vite config, App.jsx, HubHome, etc.)
4. **Run npm install**
5. **Create config.json** with hubPath and empty projects array
6. **Continue with the user's research request** (Phases 1-7 as normal, building into the hub)

## Port Management

The hub always runs on a fixed port (default: 5180) configured in:
- `config.json` → `port` field
- `vite.config.js` → `server.port`

This avoids port conflicts from multiple dev servers. Only ONE server ever runs.
